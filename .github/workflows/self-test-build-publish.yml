name: Self Test - validation workflows

on:
  push:
    branches: [main]
  pull_request:
    branches:
      - main

permissions:
  contents: read

jobs:
  test-build-publish-workflow:
    uses: ./.github/workflows/build-publish.yml
    with:
      working_directory: "./tests/valid-app"
      should_publish: false

  test-build-invalid:
    name: Test - Invalid Node npm build
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6

      - name: Set up node and deps
        uses: ./actions/setup
        with:
          working_directory: "./tests/build-invalid"

      - name: Run npm build (invalid config)
        id: build
        uses: ./actions/build
        continue-on-error: true
        with:
          working_directory: "./tests/build-invalid"

      - name: Assert failure
        run: |
          if [ "${{ steps.build.outputs.npm_build_exit_code }}" -eq 0 ]; then
            echo "Expected npm build to fail but it succeeded."
            exit 1
          fi
